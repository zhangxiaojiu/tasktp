<!DOCTYPE html>
<html>
<head>
    <title>首页 {$site_info.site_name|default=''}</title>
    <meta name="keywords" content="{$site_info.site_seo_keywords|default=''}"/>
    <meta name="description" content="{$site_info.site_seo_description|default=''}">
    <include file="public@head"/>
    <link href="__TMPL__/public/assets/css/slippry/slippry.css" rel="stylesheet">
    <style>
        .caption-wraper {
            position: absolute;
            left: 50%;
            bottom: 2em;
        }
        .caption-wraper .caption {
            position: relative;
            left: -50%;
            background-color: rgba(0, 0, 0, 0.54);
            padding: 0.4em 1em;
            color: #fff;
            -webkit-border-radius: 1.2em;
            -moz-border-radius: 1.2em;
            -ms-border-radius: 1.2em;
            -o-border-radius: 1.2em;
            border-radius: 1.2em;
        }	
        .tc-gridbox {
            margin: 0;
        }
	/* notice */
	.notice .frame{
	    height: 20px;
	    overflow: hidden;
	    margin-left:10px;
	}
	.notice .text{
	    position:relative;
	    left:0px;
	    width:700px;
	}
	/* menu */
	.menu{text-align:center;}
	.menu i{
	    font-size:35px;
	}
	.menu a{
	    color:gray;
	    text-decoration:none;
	    margin-bottom:15px;
	}
	/* ad */
	.ad {
	    margin-top:20px;
	    height:150px;
	    overflow:hidden;
	}
	/* invite */
	.invite{
	    height:150px;
	    overflow:scroll;
	}
	.invite .frame{
	    width:650px;
	    height:140px;
	    overflow:hidden;
	}
	.invite .frame .block{
	    border-radius:5px;
	    margin:5px;
	    width:120px;
	    float:left;
	    text-align:center;
	    background: -webkit-linear-gradient(#f3d2af,#fff, #f3d2af); /* Safari 5.1 - 6.0 */
	    background: -o-linear-gradient(#f3d2af,#fff, #f3d2af); /* Opera 11.1 - 12.0 */
	    background: -moz-linear-gradient(#f3d2af,#fff, #f3d2af); /* Firefox 3.6 - 15 */
	    background: linear-gradient(#f3d2af,#fff, #f3d2af); /* 标准的语法 */
	}
	.invite .frame .block .s{
	    font-size:20px;
	    background:gold;
	    border-radius:15px;
	    width:30px;
	    color:#fff;
	}
	.invite .frame .block img{
	    width:50%;
	    display:block;
	    margin:0px auto;
	    border-radius:30px;
	}
	.invite .frame .block .n{
	    margin:3px auto;
	}
	.invite .frame .block .c{
	    font-size:12px;
	    margin:2px auto;
	}	
	/* sign */
	#signInB{position:fixed; top:0px; left:0px; width:100%; height:100%; opacity:0.8; background:#000; z-index:100000; display:none;}
	#signInTable{width:610px; height:510px; position:fixed; z-index:100001; top:0px; bottom:0px; left:-110px; margin:auto; display:none;  font-family:微软雅黑;}
	#signInClose{color:#fd4a29; font-size:36px; font-weight:bold; text-align:center; width:30px; height:30px; line-height:24px; vertical-align:middle; border:3px solid #fd4a29; border-radius:20px; cursor:pointer; float:right; margin-right:140px; transform:rotate(45deg); -webkit-transform:rotate(45deg); transition:transform 0.5s; -webkit-transition:-webkit-transform 0.5s;}
	#signInClose:hover{transform:rotate(225deg); -webkit-transform:rotate(225deg);}
	#signInTable table{width:280px; height:270px; margin-left:158px; margin-top:75px; border-collapse:separate; border-spacing:1px;}
	#signInTable table th{width:40px; height:30px; text-align:center; font-size:18px; font-weight:bold; color:#3f6de0;}
	#signInTable table td{width:40px; height:40px; text-align:center; background:#fff; border-radius:5px; font-size:12px; color:#c1c2c5;}
	#signInTable table td b{font-size:20px; position:relative; top:5px;}
	#signInButton{width:100px; height:30px; line-height:30px; text-align:center; background:#ffeb42; color:#c56500; font-size:16px; font-weight:bold; margin-left:190px; margin-top:20px; border-bottom:3px solid #ffca0b; border-radius:3px; cursor:pointer;}
	/* bad */
	.bad{border:1px solid #ddd; margin:5px; padding:5px; box-shadow:2px 2px 3px #eee; border-radius:5px;}
	.bad a:hover{text-decoration:none;}
	.bad .br{border-right:1px solid #ddd;}
	.bad .block{float:left; width:50%; height:70px; padding:10px; margin-bottom:20px;}
	.bad .block .t{font-size:1.5rem; font-weight:bold; color:#666;}
	.bad .block .c{font-size:1rem; font-weight:bold; color:#aaa; margin-top:10px;}
	.bad .block img{height:50px; width:50px; float:right; position:relative; top:-50px; border-radius:5px;}

    </style>
    <hook name="before_head_end"/>
</head>
<body>

<ul id="home-slider" class="list-unstyled">
    <php>
        $top_slide_id=empty($theme_vars['top_slide'])?1:$theme_vars['top_slide'];
    </php>
    <slides id="$top_slide_id">
        <li>
            <div class="caption-wraper">
                <div class="caption hide">{$vo.title|default=''}</div>
            </div>
            <a href="{$vo.url|default=''}"><img class='img-responsive' src="{:cmf_get_image_url($vo.image)}" alt=""></a>
        </li>
    </slides>
    <noslides id="$top_slide_id">
        <li>
            <div class="caption-wraper">
                <div class="caption">此幻灯片只是演示,您没有设置任何幻灯片,请到后台模板设置！</div>
            </div>
            <a href=""><img src="__TMPL__/public/assets/images/demo/1.jpg" alt=""></a>
        </li>
        <li>
            <div class="caption-wraper">
                <div class="caption">此幻灯片只是演示,您没有设置任何幻灯片,请到后台模板设置！</div>
            </div>
            <a href=""><img src="__TMPL__/public/assets/images/demo/2.jpg" alt=""></a>
        </li>
        <li>
            <div class="caption-wraper">
                <div class="caption">此幻灯片只是演示,您没有设置任何幻灯片,请到后台模板设置！</div>
            </div>
            <a href=""><img src="__TMPL__/public/assets/images/demo/3.jpg" alt=""></a>
        </li>
    </noslides>
</ul>
<h5 class='notice'>
    <div class='col-xs-1'>
	<i class="fas fa-volume-up"></i>
    </div>
    <div class='col-xs-10 frame'>
	<div class='text'>{$notice}</div>
    </div>
</h5>
<div class="container">
    <div style="clear:both;"></div>
    <hr style="margin-top:5px;">
    <div class='menu'>
	<a href='{:url('portal/list/index')}' class='col-xs-3'>
	    <i class="fab fa-fort-awesome-alt" style='color:#8d76ff;'></i> <br>任务大厅
	</a>
	<a href='javascript:showSignIn();' class='col-xs-3'>
	    <i class="fas fa-calendar-check" style='color:#edac23;'></i> <br>今日签到
	</a>
	<a href='{:cmf_url('user/profile/share')}' class='col-xs-3'>
	    <i class="fas fa-user-plus" style='color:#3cd5f2;'></i> <br>邀请好友
	</a>
	<a href='{:cmf_url('user/profile/shareRule')}' class='col-xs-3'>
	    <i class="fab fa-wpforms" style='color:#d33935;'></i> <br>邀请规则
	</a>
	<a href='{:url('portal/list/vip')}' class='col-xs-3'>
	    <i class="fab fa-fort-awesome-alt" style='color:gold;'></i> <br>每天赚8元
	</a>
    </div>
    <div style="clear:both;"></div>
</div>
<div class="ad">
    <a href='{$ad.url}'><img class='img-responsive' src='/upload/{$ad.image}'></a>
</div>
<h4 class='text-center'><i class="fas fa-ribbon" style="color:gold;"></i> 品牌推荐</h4>
<div class='invite hide'>
    <div class='frame'>
    <foreach name='list' item='vo' key='k'>
	<div class='block'>
	    <div class='s'>{$k+1}</div>
	    <img src='{$vo.avatar}'>
	    <div class='n'>{$vo.user_nickname}</div>
	    <div class='c'>已邀请{$vo.cnum}个好友</div>
	</div>
    </foreach>
    </div>
</div>
<div class="bad">
    <foreach name='bad' item='vo' key='k'>
    <a href='{$vo.url}' class='block <if condition="$k%2 == 0">br</if>'>
	<div class='t'>{$vo.description}</div>
	<div class='c'>{$vo.content}</div>
	<empty name="vo.image">
	<img src="__TMPL__/../public/img/logo.png" class="img-responsive">
	<else/>
	<img src="/upload/{$vo.image}" class="img-responsive">
	</empty>
    </a>
    </foreach>
    <div style='clear:both;'></div>
</div>
<!-- 签到 -->
<div id="signInB"  onclick="closeSignIn();"></div>
<div id="signInTable" style="background:url(__TMPL__/public/assets/images/tasktp/tableB.png); ">
	<div id="signInClose" onclick="closeSignIn();">+</div>
	<table>
		<tr>
			<th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th><th>日</th>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		</tr>
		<tr>
			<td></td><td></td><td></td><td></td><td></td><td></td><td></td>
		</tr>
	</table>
	<div id="signInButton" onclick="signIn();">我要签到</div>
</div>
    <widget name="last_news_hide">
        <div>
            <h3 class="text-center">{$widget.title}</h3><hr>
        </div>

        <div class="row masonry">
            <php>
                $widget["vars"]["last_news_category_id"] = empty($widget["vars"]["last_news_category_id"])?1:$widget["vars"]["last_news_category_id"];
                $last_news_limit=100;
            </php>
            <portal:articles limit="$last_news_limit" order="post.published_time DESC">
                <div class="item">
                    <div class="tc-gridbox">
                        <div class="header">
                            <div class="item-image">
                                <a href="{:cmf_url('portal/Article/index',array('id'=>$vo.id,'cid'=>$vo.category_id))}">
                                    <present name="vo.more.thumbnail">
                                        <empty name="vo.more.thumbnail">
                                            <img src="__TMPL__/../public/img/logo.png"
                                                 class="img-responsive"
                                                 alt="">
                                            <else/>
                                            <img src="{:cmf_get_image_url($vo.more.thumbnail)}"
                                                 class="img-responsive resImg"
                                                 alt="">
                                        </empty>
                                        <else/>
                                        <img src="__TMPL__/public/assets/images/default-thumbnail.png"
                                             class="img-responsive"
                                             alt="">
                                    </present>
                                    <div class="post_money">
                                        ¥{$vo.post_money}
                                    </div>
                                </a>
                            </div>
                            <h3>
                                <a href="{:cmf_url('portal/Article/index',array('id'=>$vo.id,'cid'=>$vo.category_id))}">{$vo.post_title}</a>
                            </h3>
                            <hr>
                        </div>
                        <div class="body">
                            <p>
                                <a href="{:cmf_url('portal/Article/index',array('id'=>$vo.id,'cid'=>$vo.category_id))}">{$vo.post_excerpt}</a>
                            </p>
                        </div>
                    </div>
                </div>
            </portal:articles>
        </div>
    </widget>
<include file="public@footer"/>
<include file="public@scripts"/>
<script src="__TMPL__/public/assets/js/slippry.min.js"></script>
<script>
    $(function () {
        $("#home-slider").slippry({
            transition: 'fade',
            useCSS: true,
            captions: false,
            speed: 1000,
            pause: 3000,
            auto: true,
            preload: 'visible'
        });
        $("#home-slider").show();
        //图片处理
        $(".resImg").height($(".resImg").width());
	//notice
	var n = 0;
	setInterval(function(){
	    n++;
	    if(n>=500){
		n =  0;
	    }
	    $('.text').css('left','-'+n+'px');
	},50);
    });

/* sign */
function showSignIn(){
    $("#signInB").fadeIn();
    $("#signInTable").fadeIn();
    $.post("{:url('user/profile/sign')}",function(data){
	getInfo(eval(data));
    });
}
function closeSignIn(){
    $("#signInB").fadeOut();
    $("#signInTable").fadeOut();
}
function signIn(){
    $("#signInButton").css({"border-bottom":"none","margin-top":"23px"});
    setTimeout(function(){
	    $("#signInButton").css({"border-bottom":"3px solid #ffca0b","margin-top":"20px"});
    },200);
    $.post("{:url('user/profile/doSign')}",function(data){
	    getInfo(eval(data));
	    $("#signInButton").css({"border-bottom":"none","margin-top":"23px"});
	    $("#signInButton").text("已签到");
    });
}
function getInfo(arr) {
    var d = new Date();
    var y = d.getFullYear();
    var m = d.getMonth();
    var dd = d.getDate();
    // what day of the week is first day of the month
    d.setFullYear(y,m,1);
    var w = d.getDay();
    if (w == 0) w = 7;
    // total day of month
    if(m == 11){
	    d.setFullYear(y+1,0,0);
    }else{
	    d.setFullYear(y,m+1, 0);
    }
    var ad = d.getDate();
    //let's do sth
    for(var i = 1; i <= ad; i++){
	    $("#signInTable td:eq("+(w+i-2)+")").html("<span><b>"+i+"</b><br/>"+(m+1)+"月</span>");
    }	
    for(var j in arr){
	    $("#signInTable td:eq("+(arr[j]+w-2)+")").css({"color":"#5685fd","background":"#fff url(__TMPL__/public/assets/images/tasktp/./yes.png) no-repeat right top"});
	    if(arr[j] == dd){
		    $("#signInButton").text("已签到");
	    }
    }
}

</script>
<hook name="before_body_end"/>
</body>
</html>
